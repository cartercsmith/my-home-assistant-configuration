###############################################################################################################
# AUTOMATION_MEDIAPLAYER_VIDEO:
###############################################################################################################
#
# Automations for chromecast, plex, apple tv, ...
#
###############################################################################################################
  - alias: Mediaplayer on TV paused or stopped

    trigger:
      - platform: state
        entity_id:
          - media_player.plex_apple_tv
          - media_player.chromecast
          - media_player.apple_tv

    condition:
      - condition: state
        entity_id: input_boolean.tv_onoff
        state: 'on'
      - condition: state
        entity_id: input_boolean.disable_all_automations
        state: 'off'
      - condition: template
        value_template: "{{ trigger.from_state.state == 'playing' }}"


    action:
      - service: input_boolean.turn_off
        entity_id: input_boolean.tv_onoff
      - service: scene.turn_on
        entity_id: scene.livingroom_dimmed


###############################################################################################################
  - alias: Mediaplayer on TV playing

    trigger:
      - platform: state
        entity_id:
          - media_player.chromecast
          - media_player.plex_apple_tv
        to: 'playing'
        for:
          seconds: 2
      - platform: template
        value_template: "{{ states.media_player.apple_tv.state == 'playing' and states.media_player.plex_apple_tv.state != 'playing' }}"

    condition:
      - condition: state
        entity_id: input_boolean.disable_all_automations
        state: 'off'

    action:
      - service: media_player.turn_off
        data:
          entity_id:
            - media_player.soundtouch_living_room
            - media_player.google_home
      - delay: 2
      - condition: and
        conditions:
          - condition: template
            value_template: "{{ states.media_player.chromecast.attributes.media_title != 'Het journaal ' }}"
          - condition: template
            value_template: "{{ states.media_player.chromecast.attributes.media_title != 'Het journaal - Sportweekend' }}"
          - condition: state
            entity_id: sun.sun
            state: 'below_horizon'
      - service: scene.turn_on
        entity_id: scene.livingroom_watch_tv_blue
      - service: input_boolean.turn_on
        entity_id: input_boolean.tv_onoff

